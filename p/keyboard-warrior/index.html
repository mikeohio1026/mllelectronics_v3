<!doctype html><html lang=en-us>
<head><meta charset=utf-8>
<meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Custom STM32F303RET7 Mechanical Keyboard"><title>Keyboard Warrior</title>
<link rel=canonical href=https://mllelectronics.com/p/keyboard-warrior/>
<link rel=stylesheet href=/scss/style.min.css><meta property="og:title" content="Keyboard Warrior">
<meta property="og:description" content="Custom STM32F303RET7 Mechanical Keyboard">
<meta property="og:url" content="https://mllelectronics.com/p/keyboard-warrior/">
<meta property="og:site_name" content="MLL Electronics">
<meta property="og:type" content="article"><meta property="article:section" content="Post"><meta property="article:tag" content="Electronics"><meta property="article:published_time" content="2021-04-28T00:00:00+00:00"><meta property="article:modified_time" content="2021-04-28T00:00:00+00:00"><meta property="og:image" content="https://mllelectronics.com/p/keyboard-warrior/stm32_complete.jpg">
<meta name=twitter:title content="Keyboard Warrior">
<meta name=twitter:description content="Custom STM32F303RET7 Mechanical Keyboard"><meta name=twitter:card content="summary_large_image">
<meta name=twitter:image content="https://mllelectronics.com/p/keyboard-warrior/stm32_complete.jpg">
</head>
<body class="article-page has-toc">
<script>(function(){const a='StackColorScheme';localStorage.getItem(a)||localStorage.setItem(a,"auto")})()</script><script>(function(){const b='StackColorScheme',a=localStorage.getItem(b),c=window.matchMedia('(prefers-color-scheme: dark)').matches===!0;a=='dark'||a==='auto'&&c?document.documentElement.dataset.scheme='dark':document.documentElement.dataset.scheme='light'})()</script>
<div class="container main-container flex
extended">
<div id=article-toolbar>
<a href=https://mllelectronics.com/ class=back-home><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-chevron-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><polyline points="15 6 9 12 15 18"/></svg>
<span>Back</span>
</a>
</div>
<main class="main full-width">
<article class="has-image main-article">
<header class=article-header>
<div class=article-image>
<a href=/p/keyboard-warrior/>
<img src=/p/keyboard-warrior/stm32_complete_hu6dd7ed0bcc175564937ceaac420271ca_254600_800x0_resize_q75_box.jpg srcset="/p/keyboard-warrior/stm32_complete_hu6dd7ed0bcc175564937ceaac420271ca_254600_800x0_resize_q75_box.jpg 800w, /p/keyboard-warrior/stm32_complete_hu6dd7ed0bcc175564937ceaac420271ca_254600_1600x0_resize_q75_box.jpg 1600w" width=800 height=450 loading=lazy alt="Featured image of post Keyboard Warrior">
</a>
</div>
<div class=article-details>
<header class=article-category>
<a href=/categories/stm32-uc/>
STM32 uC
</a>
<a href=/categories/custom-mechanical-keyboard/>
Custom Mechanical Keyboard
</a>
</header>
<h2 class=article-title>
<a href=/p/keyboard-warrior/>Keyboard Warrior</a>
</h2>
<h3 class=article-subtitle>
Custom STM32F303RET7 Mechanical Keyboard
</h3>
<footer class=article-time>
<div><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M11.795 21H5a2 2 0 01-2-2V7a2 2 0 012-2h12a2 2 0 012 2v4"/><circle cx="18" cy="18" r="4"/><path d="M15 3v4"/><path d="M7 3v4"/><path d="M3 11h16"/><path d="M18 16.496V18l1 1"/></svg>
<time class=article-time--published>Apr 28, 2021</time>
</div>
<div><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><polyline points="12 7 12 12 15 15"/></svg>
<time class=article-time--reading>
3 minute read
</time>
</div>
</footer>
</div>
</header>
<section class=article-content>
<h2 id=introduction-to-keyboard-warrior>Introduction to Keyboard Warrior</h2>
<p>This a page about the Keyboard Warrior which was my Senior Project for my Electrical and Electronic engineering degree at the University of Akron.</p>
<h2 id=hardware-layout--design-considerations>Hardware Layout & Design Considerations</h2>
<p>The badge is based on STM32F303RET6 processor which has 26 I/O, builtin 512kB of flash memory, 80kB of RAM, and operates at 3.3 volts with a max clock frequnecy of 72 MHz. Communication and debug on this board consisted of DFU (Device Firmware Update) via USB C and a SWD(Serial Wire debug) port. This project was split into two parts one being the main devboard that had STM32F303 and a daughter board being a keyboard with deattachable accessories. The fimware on the board is the QMK (Quantum Mechnical keyboard) and is very customizable. Some highlights regarding design include the pogo pin connector for modular attachments via I2C bus, design for high USB connection, crystal oscillator and power supply layout.</p>
<p><figure class=gallery-image style=flex-grow:173;flex-basis:417px>
<a href=/p/keyboard-warrior/stm32_block.jpg data-size=963x554>
<img src=/p/keyboard-warrior/stm32_block.jpg width=963 height=554 srcset="/p/keyboard-warrior/stm32_block_hu9a3be497284e9ba7186935c774bd8b41_25970_480x0_resize_q75_box.jpg 480w, /p/keyboard-warrior/stm32_block_hu9a3be497284e9ba7186935c774bd8b41_25970_1024x0_resize_q75_box.jpg 1024w" loading=lazy alt="Keyboard Warrior Block Diagram">
</a>
<figcaption>Keyboard Warrior Block Diagram</figcaption>
</figure></p>
<p>The block diagram outlines what I envisioned as the ultimate modular mechanical keyboard that has a wide variety of attachments that would fit any situtation. With the addition of an I2C bus on the keyboard this would allow for a variety of expansions but the main focus for this project was the Numeric Keypad module as it was most realistic given the time frame for this project. Schematics are included below and are broken into a uC development module, the main keyboard and the attachment keyboard.</p>
<p><figure class=gallery-image style=flex-grow:113;flex-basis:272px>
<a href=/p/keyboard-warrior/stm32_crystal.jpg data-size=671x590>
<img src=/p/keyboard-warrior/stm32_crystal.jpg width=671 height=590 srcset="/p/keyboard-warrior/stm32_crystal_hu098135d4ed694729ab743af6f9ebbaa7_92391_480x0_resize_q75_box.jpg 480w, /p/keyboard-warrior/stm32_crystal_hu098135d4ed694729ab743af6f9ebbaa7_92391_1024x0_resize_q75_box.jpg 1024w" loading=lazy alt="Crystal Oscillator Layout">
</a>
<figcaption>Crystal Oscillator Layout</figcaption>
</figure>
<figure class=gallery-image style=flex-grow:181;flex-basis:435px>
<a href=/p/keyboard-warrior/stm32_clock.jpg data-size=1503x829>
<img src=/p/keyboard-warrior/stm32_clock.jpg width=1503 height=829 srcset="/p/keyboard-warrior/stm32_clock_hu6a2880662a0e51bfbcb516decfeecfce_124875_480x0_resize_q75_box.jpg 480w, /p/keyboard-warrior/stm32_clock_hu6a2880662a0e51bfbcb516decfeecfce_124875_1024x0_resize_q75_box.jpg 1024w" loading=lazy alt="STM32 Clock Configurator">
</a>
<figcaption>STM32 Clock Configurator</figcaption>
</figure></p>
<p>The crystal oscillator layout was an area that I focused on when designing the dev board. The ST Microelectronics AN2867 application note was very informative on the design of Pierce oscillators which are critical to the ensuring stable and reliable operation from the microcontroller. The goal of this design was to generate a 48 MHz clock which was required by the USB protocol. STM32 Cube IDE has a Clock Frequency configurator which validated my selection of the J49SMH which is 8 MHZ quartz oscillator at Â±30ppm with a load capacitance of 12 pF.</p>
<p><figure class=gallery-image style=flex-grow:85;flex-basis:204px>
<a href=/p/keyboard-warrior/stm32_differential.jpg data-size=468x548>
<img src=/p/keyboard-warrior/stm32_differential.jpg width=468 height=548 srcset="/p/keyboard-warrior/stm32_differential_hu4955d3a87fca937c34dd24c61d0fc9ff_69549_480x0_resize_q75_box.jpg 480w, /p/keyboard-warrior/stm32_differential_hu4955d3a87fca937c34dd24c61d0fc9ff_69549_1024x0_resize_q75_box.jpg 1024w" loading=lazy alt="USB C - Differential Routing">
</a>
<figcaption>USB C - Differential Routing</figcaption>
</figure>
<figure class=gallery-image style=flex-grow:116;flex-basis:280px>
<a href=/p/keyboard-warrior/stm32_supply_layout.jpg data-size=727x622>
<img src=/p/keyboard-warrior/stm32_supply_layout.jpg width=727 height=622 srcset="/p/keyboard-warrior/stm32_supply_layout_hu4cf42d6623c3709db7492a6a6d9903fb_86420_480x0_resize_q75_box.jpg 480w, /p/keyboard-warrior/stm32_supply_layout_hu4cf42d6623c3709db7492a6a6d9903fb_86420_1024x0_resize_q75_box.jpg 1024w" loading=lazy alt="Power Supply Design">
</a>
<figcaption>Power Supply Design</figcaption>
</figure></p>
<p>The USB C protcool requires that signal runs be as short as possible and the data line pairs be differentially routed as to minimize issues with signal quality. Note that USB ESD protection chip was also placed inline with the STM32F303 microcontroller. Thought was also put into my DRC rules and power supply design.</p>
<p><figure class=gallery-image style=flex-grow:91;flex-basis:220px>
<a href=/p/keyboard-warrior/stm32_outline.jpg data-size=565x615>
<img src=/p/keyboard-warrior/stm32_outline.jpg width=565 height=615 srcset="/p/keyboard-warrior/stm32_outline_hu831d70827d40d3df0caef5e052b2d329_50640_480x0_resize_q75_box.jpg 480w, /p/keyboard-warrior/stm32_outline_hu831d70827d40d3df0caef5e052b2d329_50640_1024x0_resize_q75_box.jpg 1024w" loading=lazy alt="Finalized Component Layout">
</a>
<figcaption>Finalized Component Layout</figcaption>
</figure>
<figure class=gallery-image style=flex-grow:103;flex-basis:248px>
<a href=/p/keyboard-warrior/stm32_render.jpg data-size=792x765>
<img src=/p/keyboard-warrior/stm32_render.jpg width=792 height=765 srcset="/p/keyboard-warrior/stm32_render_hu699dc281e0f25a5235e928e45996a18f_100283_480x0_resize_q75_box.jpg 480w, /p/keyboard-warrior/stm32_render_hu699dc281e0f25a5235e928e45996a18f_100283_1024x0_resize_q75_box.jpg 1024w" loading=lazy alt="Keyboard Warrior Mechanical Render">
</a>
<figcaption>Keyboard Warrior Mechanical Render</figcaption>
</figure></p>
<p>This layout is a standard microcontroller layout that follows sound engineering practices that emphasize stability, functionality and reliable design.</p>
<h2 id=mechanical-design>Mechanical Design</h2>
<p>The case is made of combination of 1/16th and 3/16th stacked 6061 aluminum that sandwhiches the main keyboard circuit board. It utilzes Torx screws to hold the everything together. All CAD modeling was done in Solidworks 2020 to make sure that everything fit and CAM was done with the WardCAM software. One the biggest challanges was cutting out the 1/16" 6061 on the waterjet as cutting materials under 1/8" is difficult due the turbulence of the jet stream flexing the thin metal plate.</p>
<p><figure class=gallery-image style=flex-grow:133;flex-basis:320px>
<a href=/p/keyboard-warrior/keyboard_stack.jpg data-size=2048x1536>
<img src=/p/keyboard-warrior/keyboard_stack.jpg width=2048 height=1536 srcset="/p/keyboard-warrior/keyboard_stack_huf008e2c24bb1825c723e53d568c5539c_300916_480x0_resize_q75_box.jpg 480w, /p/keyboard-warrior/keyboard_stack_huf008e2c24bb1825c723e53d568c5539c_300916_1024x0_resize_q75_box.jpg 1024w" loading=lazy alt="Keyboard Warrior Mechanical Stackup">
</a>
<figcaption>Keyboard Warrior Mechanical Stackup</figcaption>
</figure></p>
<p><figure class=gallery-image style=flex-grow:133;flex-basis:320px>
<a href=/p/keyboard-warrior/keyboard_assemble.jpg data-size=4032x3024>
<img src=/p/keyboard-warrior/keyboard_assemble.jpg width=4032 height=3024 srcset="/p/keyboard-warrior/keyboard_assemble_hu474b55ecd88037c125f2cfa204d1ebf2_2895377_480x0_resize_q75_box.jpg 480w, /p/keyboard-warrior/keyboard_assemble_hu474b55ecd88037c125f2cfa204d1ebf2_2895377_1024x0_resize_q75_box.jpg 1024w" loading=lazy alt="Keyboard Assembly Time">
</a>
<figcaption>Keyboard Assembly Time</figcaption>
</figure></p>
<p><figure class=gallery-image style=flex-grow:179;flex-basis:431px>
<a href=/p/keyboard-warrior/keyboard_full.jpg data-size=1499x834>
<img src=/p/keyboard-warrior/keyboard_full.jpg width=1499 height=834 srcset="/p/keyboard-warrior/keyboard_full_hu5c9adf3edef0493fa205da07c92889af_214779_480x0_resize_q75_box.jpg 480w, /p/keyboard-warrior/keyboard_full_hu5c9adf3edef0493fa205da07c92889af_214779_1024x0_resize_q75_box.jpg 1024w" loading=lazy alt="Full Keyboard">
</a>
<figcaption>Full Keyboard</figcaption>
</figure>
<figure class=gallery-image style=flex-grow:98;flex-basis:236px>
<a href=/p/keyboard-warrior/keyboard_side.jpg data-size=688x697>
<img src=/p/keyboard-warrior/keyboard_side.jpg width=688 height=697 srcset="/p/keyboard-warrior/keyboard_side_hu2b804ce995963586a04d860183a4a096_80861_480x0_resize_q75_box.jpg 480w, /p/keyboard-warrior/keyboard_side_hu2b804ce995963586a04d860183a4a096_80861_1024x0_resize_q75_box.jpg 1024w" loading=lazy alt="Keyboard attachment">
</a>
<figcaption>Keyboard attachment</figcaption>
</figure></p>
<h2 id=software-used>Software Used</h2>
<ul>
<li>KiCad V5.1 - PCB Schematic and Electronic Design Software</li>
<li>STM32 Cube IDE - PLL Clock configurator and intial testing of STM32F303</li>
<li>Solidworks 2019 - Mechanical design software</li>
<li>WardCAM - Waterjet custom case</li>
</ul>
<p><figure class=gallery-image style=flex-grow:133;flex-basis:320px>
<a href=/p/keyboard-warrior/keyboard_flash.jpg data-size=4032x3024>
<img src=/p/keyboard-warrior/keyboard_flash.jpg width=4032 height=3024 srcset="/p/keyboard-warrior/keyboard_flash_hu0b06e2a541f3fe4ba2d9e13f1e83b2bb_2953863_480x0_resize_q75_box.jpg 480w, /p/keyboard-warrior/keyboard_flash_hu0b06e2a541f3fe4ba2d9e13f1e83b2bb_2953863_1024x0_resize_q75_box.jpg 1024w" loading=lazy alt="Prepped for Flashing with STM32 Cube IDE">
</a>
<figcaption>Prepped for Flashing with STM32 Cube IDE</figcaption>
</figure></p>
<h2 id=lessons-learned>Lessons Learned</h2>
<ol>
<li>Don&rsquo;t underestimate the time it takes to write embedded software</li>
<li>Tolerance stacks matter and header pins add height which need to be accounted for</li>
</ol>
<h2 id=future-plans>Future Plans</h2>
<ul>
<li>Keyboard Warrior V2 - Builtin USB 3.0 Hub, RGB back light and new 80% keyboard layout</li>
<li>Continue development on the I2C bus code and additional acessories</li>
</ul>
</section>
<footer class=article-footer>
<section class=article-tags>
<a href=/tags/electronics/>Electronics</a>
</section>
<section class=article-copyright><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-copyright" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><path d="M14.5 9a3.5 4 0 100 6"/></svg>
<span>Licensed under CC BY-NC-SA 4.0</span>
</section>
</footer>
</article>
<aside class=related-contents--wrapper>
</aside>
<div class=disqus-container>
<div id=disqus_thread></div>
<script type=application/javascript>var disqus_config=function(){};(function(){if(["localhost","127.0.0.1"].indexOf(window.location.hostname)!=-1){document.getElementById('disqus_thread').innerHTML='Disqus comments not available by default when the website is previewed locally.';return}var b=document,a=b.createElement('script');a.async=!0,a.src='//hugo-theme-stack.disqus.com/embed.js',a.setAttribute('data-timestamp',+new Date),(b.head||b.body).appendChild(a)})()</script>
<noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript>
<a href=https://disqus.com class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a>
</div>
<style>.disqus-container{background-color:var(--card-background);border-radius:var(--card-border-radius);box-shadow:var(--shadow-l1);padding:var(--card-padding)}</style>
<script>window.addEventListener('onColorSchemeChange',a=>{DISQUS&&DISQUS.reset({reload:!0})})</script>
<footer class=site-footer>
<section class=copyright>
&copy;
2020 -
2021 MLL Electronics
</section>
<section class=powerby>
Built with <a href=https://gohugo.io/ target=_blank rel=noopener>Hugo</a> <br>
Theme <b><a href=https://github.com/CaiJimmy/hugo-theme-stack target=_blank rel=noopener data-version=3.2.0>Stack</a></b> designed by <a href=https://jimmycai.com target=_blank rel=noopener>Jimmy</a>
</section>
</footer>
<div class=pswp tabindex=-1 role=dialog aria-hidden=true>
<div class=pswp__bg></div>
<div class=pswp__scroll-wrap>
<div class=pswp__container>
<div class=pswp__item></div>
<div class=pswp__item></div>
<div class=pswp__item></div>
</div>
<div class="pswp__ui pswp__ui--hidden">
<div class=pswp__top-bar>
<div class=pswp__counter></div>
<button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
<button class="pswp__button pswp__button--share" title=Share></button>
<button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
<button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>
<div class=pswp__preloader>
<div class=pswp__preloader__icn>
<div class=pswp__preloader__cut>
<div class=pswp__preloader__donut></div>
</div>
</div>
</div>
</div>
<div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
<div class=pswp__share-tooltip></div>
</div>
<button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
</button>
<button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
</button>
<div class=pswp__caption>
<div class=pswp__caption__center></div>
</div>
</div>
</div>
</div><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo=" crossorigin=anonymous defer></script><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU=" crossorigin=anonymous defer></script><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.css integrity="sha256-c0uckgykQ9v5k+IqViZOZKc47Jn7KQil4/MP3ySA3F8=" crossorigin=anonymous><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.css integrity="sha256-SBLU4vv6CA6lHsZ1XyTdhyjJxCjPif/TRkjnsyGAGnE=" crossorigin=anonymous>
</main>
<aside class="sidebar right-sidebar sticky">
<section class="widget archives">
<div class=widget-icon><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><line x1="5" y1="9" x2="19" y2="9"/><line x1="5" y1="15" x2="19" y2="15"/><line x1="11" y1="4" x2="7" y2="20"/><line x1="17" y1="4" x2="13" y2="20"/></svg>
</div>
<h2 class="widget-title section-title">Table of contents</h2>
<div class=widget--toc>
<nav id=TableOfContents>
<ol>
<li><a href=#introduction-to-keyboard-warrior>Introduction to Keyboard Warrior</a></li>
<li><a href=#hardware-layout--design-considerations>Hardware Layout & Design Considerations</a></li>
<li><a href=#mechanical-design>Mechanical Design</a></li>
<li><a href=#software-used>Software Used</a></li>
<li><a href=#lessons-learned>Lessons Learned</a></li>
<li><a href=#future-plans>Future Plans</a></li>
</ol>
</nav>
</div>
</section>
</aside>
</div>
<script src=https://cdn.jsdelivr.net/npm/node-vibrant@3.1.5/dist/vibrant.min.js integrity="sha256-5NovOZc4iwiAWTYIFiIM7DxKUXKWvpVEuMEPLzcm5/g=" crossorigin=anonymous defer></script><script type=text/javascript src=/ts/main.js defer></script>
<script>(function(){const a=document.createElement('link');a.href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap",a.type="text/css",a.rel="stylesheet",document.head.appendChild(a)})()</script>
</body>
</html>